<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPressË®ò‰∫ãÁßªÁÆ°„ÉÑ„Éº„É´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            height: 100vh;
            display: grid;
            grid-template-rows: 25% 75%;
            grid-template-columns: 50% 50%;
            background: #f5f5f5;
            gap: 0;
            overflow: hidden;
        }

        .top-left-panel {
            grid-row: 1;
            grid-column: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-right: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            overflow: hidden;
        }

        .top-right-panel {
            grid-row: 1;
            grid-column: 2;
            display: flex;
            flex-direction: column;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            overflow: hidden;
        }

        .bottom-left-panel {
            grid-row: 2;
            grid-column: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-right: 1px solid #e0e0e0;
            overflow: hidden;
        }

        .bottom-right-panel {
            grid-row: 2;
            grid-column: 2;
            display: flex;
            flex-direction: column;
            background: white;
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 12px 16px;
            min-height: 48px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
        }

        .header h1 {
            font-size: 16px;
            margin: 0;
        }

        .paste-area {
            background: #34495e;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .paste-area label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: bold;
            color: #ecf0f1;
        }

        .paste-area textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            font-size: 13px;
            border: 2px solid #7f8c8d;
            border-radius: 6px;
            background: #2c3e50;
            color: #ecf0f1;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
        }

        .paste-area textarea:focus {
            outline: none;
            border-color: #3498db;
            background: #34495e;
        }

        .paste-area textarea::placeholder {
            color: #95a5a6;
        }

        .url-input-area {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .url-input-area input {
            flex: 1;
            padding: 12px 16px;
            font-size: 14px;
            border: 2px solid #34495e;
            border-radius: 6px;
            background: white;
        }

        .url-input-area input:focus {
            outline: none;
            border-color: #3498db;
        }

        .url-input-area button {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .url-input-area button:hover {
            background: #2980b9;
        }

        .url-input-area button.success {
            background: #27ae60;
        }

        .url-input-area button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .instructions {
            font-size: 13px;
            color: #bdc3c7;
            margin-top: 8px;
            line-height: 1.6;
        }

        .instructions strong {
            color: #3498db;
        }

        .loading {
            display: none;
            color: #3498db;
            font-size: 14px;
            margin-top: 8px;
        }

        .loading.active {
            display: block;
        }

        .panel-header {
            padding: 12px 16px;
            background: #ecf0f1;
            border-bottom: 1px solid #bdc3c7;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 48px;
            box-sizing: border-box;
        }

        .panel-header h2 {
            font-size: 16px;
            color: #2c3e50;
            margin: 0;
        }

        .panel-header button {
            padding: 8px 16px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: background 0.2s;
        }

        .panel-header button:hover {
            background: #229954;
        }

        .panel-header button.copied {
            background: #3498db;
        }

        .title-area {
            padding: 16px;
            background: #fff9e6;
            border-bottom: 1px solid #e0e0e0;
        }

        .title-area label {
            font-size: 12px;
            color: #666;
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
        }

        #titleDisplay {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            font-weight: bold;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            background: white;
            resize: none;
            font-family: 'Segoe UI', sans-serif;
            min-height: 60px;
        }

        .html-output {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            background: #fafafa;
        }

        .markdown-editor {
            flex: 1;
            width: 100%;
            padding: 16px;
            font-size: 14px;
            line-height: 1.6;
            border: none;
            resize: none;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .markdown-editor:focus {
            outline: none;
        }

        .images-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 16px;
            overflow-y: auto;
            flex: 1;
        }

        .image-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: all 0.2s;
        }

        .image-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #3498db;
        }

        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            cursor: grab;
            border: 1px solid #eee;
        }

        .image-item img:active {
            cursor: grabbing;
        }

        .image-item .image-info {
            font-size: 11px;
            color: #999;
            text-align: center;
            padding: 4px;
        }

        .image-item button {
            padding: 6px 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .image-item button:hover {
            background: #2980b9;
        }

        .image-item button.copied {
            background: #27ae60;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 14px;
        }

        .toolbar {
            display: flex;
            gap: 4px;
            padding: 12px;
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .toolbar button {
            padding: 6px 12px;
            border: 1px solid #d0d0d0;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .toolbar button:hover {
            background: #f0f0f0;
            border-color: #999;
        }
    </style>
</head>
<body>
    <!-- Â∑¶‰∏äÔºöÁîªÂÉè‰∏ÄË¶ß (25%) -->
    <div class="top-left-panel">
        <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h2>üì∑ ÁîªÂÉè‰∏ÄË¶ß</h2>
            <div style="display: flex; gap: 8px;">
                <button onclick="openAllImages()" style="padding: 6px 12px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px;">„Åô„Åπ„Å¶„ÅÆÁîªÂÉè„ÇíÊñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„Åè</button>
            </div>
        </div>
        <div class="images-grid" id="imagesGrid" style="padding: 12px; overflow-y: auto; flex: 1;">
            <div class="empty-state">ÁîªÂÉè„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</div>
        </div>
    </div>

    <!-- Âè≥‰∏äÔºöHTML„ÇΩ„Éº„ÇπË≤º„Çä‰ªò„Åë (25%) -->
    <div class="top-right-panel">
        <div class="header">
            <h1>üìã HTML„ÇΩ„Éº„ÇπË≤º„Çä‰ªò„Åë</h1>
        </div>
        <div class="paste-area" style="flex: 1; display: flex; flex-direction: column; padding: 12px;">
            <textarea id="htmlSource" placeholder="HTML„ÇΩ„Éº„Çπ„ÇíË≤º„Çä‰ªò„Åë" style="flex: 1; font-size: 12px; margin-bottom: 8px;"></textarea>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="urlInput" placeholder="Ë®ò‰∫ãURL" style="flex: 1; font-size: 12px; padding: 6px 10px;">
                <button onclick="loadFromPaste()" id="loadButton" style="font-size: 12px; padding: 6px 16px; white-space: nowrap; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Ë™≠„ÅøËæº„ÇÄ</button>
            </div>
            <div class="loading" id="loading" style="font-size: 12px; margin-top: 4px;">Âá¶ÁêÜ‰∏≠...</div>
        </div>
    </div>

    <!-- Â∑¶‰∏ãÔºöHTMLÂá∫Âäõ (75%) -->
    <div class="bottom-left-panel">
        <div class="panel-header">
            <h2>üìã HTMLÂá∫Âäõ</h2>
        </div>
        <div class="title-area" style="padding: 8px 16px;">
            <label style="font-size: 12px; margin-bottom: 4px; display: block;">„Çø„Ç§„Éà„É´ÔºàH1Ôºâ</label>
            <div style="display: flex; gap: 8px; align-items: stretch;">
                <textarea id="titleDisplay" readonly placeholder="H1„Çø„Ç§„Éà„É´..." style="flex: 1; height: 40px; font-size: 13px;"></textarea>
                <button onclick="copyTitle()" style="padding: 6px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; white-space: nowrap; font-size: 12px;">„Ç≥„Éî„Éº</button>
            </div>
        </div>
        <div class="client-area" style="padding: 8px 16px;">
            <label style="font-size: 12px; margin-bottom: 4px; display: block;">„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂêç</label>
            <div style="display: flex; gap: 8px; align-items: stretch;">
                <input type="text" id="clientDisplay" readonly placeholder="„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂêç..." style="flex: 1; height: 32px; font-size: 13px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px;">
                <button onclick="copyClient()" style="padding: 6px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; white-space: nowrap; font-size: 12px;">„Ç≥„Éî„Éº</button>
            </div>
        </div>
        <div class="slug-area" style="padding: 8px 16px;">
            <label style="font-size: 12px; margin-bottom: 4px; display: block;">„Éá„Ç£„É¨„ÇØ„Éà„É™Âêç</label>
            <div style="display: flex; gap: 8px; align-items: stretch;">
                <input type="text" id="slugDisplay" readonly placeholder="„Éá„Ç£„É¨„ÇØ„Éà„É™Âêç..." style="flex: 1; height: 32px; font-size: 13px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px;">
                <button onclick="copySlug()" style="padding: 6px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; white-space: nowrap; font-size: 12px;">„Ç≥„Éî„Éº</button>
            </div>
        </div>
        <div style="padding: 8px 16px; display: flex; justify-content: flex-end;">
            <button onclick="copyHTML()" id="copyHTMLBtn" style="padding: 6px 12px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; white-space: nowrap; font-size: 12px;">HTML„Çí„Ç≥„Éî„Éº</button>
        </div>
        <div class="html-output" id="htmlOutput" style="flex: 1;">
            <div class="empty-state">URL„ÇíÂÖ•Âäõ„Åó„Å¶„ÄåË®ò‰∫ã„ÇíË™≠„ÅøËæº„ÇÄ„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
        </div>
    </div>

    <!-- Âè≥‰∏ãÔºö„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Á∑®ÈõÜ (87.5%) -->
    <div class="bottom-right-panel">
        <div class="panel-header">
            <h2>‚úèÔ∏è „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Á∑®ÈõÜ</h2>
        </div>
        <div class="toolbar">
            <button onclick="applyFormat('h1')" title="Ë¶ãÂá∫„Åó1">H1</button>
            <button onclick="applyFormat('h2')" title="Ë¶ãÂá∫„Åó2">H2</button>
            <button onclick="applyFormat('h3')" title="Ë¶ãÂá∫„Åó3">H3</button>
            <button onclick="applyFormat('h4')" title="Ë¶ãÂá∫„Åó4">H4</button>
            <button onclick="applyFormat('h5')" title="Ë¶ãÂá∫„Åó5">H5</button>
            <button onclick="applyFormat('h6')" title="Ë¶ãÂá∫„Åó6">H6</button>
            <button onclick="applyFormat('bold')" title="Â§™Â≠ó"><strong>B</strong></button>
            <button onclick="clearFormat()" title="Êõ∏ÂºèËß£Èô§">Ëß£Èô§</button>
            <button onclick="applyFormat('ul')" title="ÁÆáÊù°Êõ∏„Åç">‚Ä¢</button>
            <button onclick="applyFormat('ol')" title="Áï™Âè∑‰ªò„Åç„É™„Çπ„Éà">1.</button>
            <button onclick="applyFormat('caption')" title="„Ç≠„É£„Éó„Ç∑„Éß„É≥">ÔºàC</button>
            <button onclick="applyFormat('alt')" title="ALT">ÔºàALT</button>
            <button onclick="applyFormat('image')" title="ÁîªÂÉè">ÁîªÂÉè</button>
            <button onclick="applyFormat('paragraph')" title="ÊÆµËêΩ">P</button>
            <button onclick="insertHR()" title="Ê∞¥Âπ≥Á∑ö">---</button>
            <button onclick="deleteLine()" title="ÂâäÈô§" style="color: #d32f2f;">ÂâäÈô§</button>
            <button onclick="insertLineBreak()" title="ÊîπË°å">ÊîπË°å</button>
            <button onclick="resetAll()" title="„É™„Çª„ÉÉ„Éà">„É™„Çª„ÉÉ„Éà</button>
        </div>
        <textarea class="markdown-editor" id="markdownEditor" placeholder="„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇÁ∑®ÈõÜÂÜÖÂÆπ„ÅØËá™Âãï„ÅßÂèçÊò†„Åï„Çå„Åæ„Åô„ÄÇ"></textarea>
    </div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const htmlSource = document.getElementById('htmlSource');
        const loading = document.getElementById('loading');
        const htmlOutput = document.getElementById('htmlOutput');
        const titleDisplay = document.getElementById('titleDisplay');
        const clientDisplay = document.getElementById('clientDisplay');
        const slugDisplay = document.getElementById('slugDisplay');
        const markdownEditor = document.getElementById('markdownEditor');
        const imagesGrid = document.getElementById('imagesGrid');
        
        // „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Ëá™ÂãïÊõ¥Êñ∞
        markdownEditor.addEventListener('input', function() {
            updateHTML();
        });
        const loadButton = document.getElementById('loadButton');

        let articleImages = [];

        function loadFromPaste() {
            const html = htmlSource.value.trim();
            if (!html) {
                alert('‚ùå HTML„ÇΩ„Éº„Çπ„ÅåÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì\n\nË®ò‰∫ã„Éö„Éº„Ç∏„ÅÆ„ÇΩ„Éº„Çπ„Çí„Ç≥„Éî„Éº„Åó„Å¶Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            const url = urlInput.value.trim() || 'https://example.com/article/';
            
            loading.classList.add('active');
            loadButton.disabled = true;
            
            setTimeout(() => {
                try {
                    parseArticle(html, url);
                    loadButton.textContent = '‚úÖ Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÔºÅ';
                    loadButton.classList.add('success');
                    setTimeout(() => {
                        loadButton.textContent = 'Ë®ò‰∫ã„ÇíË™≠„ÅøËæº„ÇÄ';
                        loadButton.classList.remove('success');
                    }, 3000);
                } catch (error) {
                    console.error('Error:', error);
                    alert('‚ùå Ë®ò‰∫ã„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü\n\n„Ç®„É©„Éº: ' + error.message);
                } finally {
                    loading.classList.remove('active');
                    loadButton.disabled = false;
                }
            }, 100);
        }

        function parseArticle(html, baseUrl) {
            console.log('parseArticle ÈñãÂßã');
            console.log('HTML length:', html.length);
            console.log('HTML preview (first 500 chars):', html.substring(0, 500));
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            console.log('DOMParser ÂÆå‰∫Ü');
            
            // Ë®ò‰∫ãÊú¨Êñá„ÇíÊäΩÂá∫ÔºàË§áÊï∞„ÅÆ„Éë„Çø„Éº„É≥„Å´ÂØæÂøúÔºâ
            let articleContent = doc.querySelector('.post_content') ||
                                doc.querySelector('.entry-content') ||
                                doc.querySelector('article .entry-content') ||
                                doc.querySelector('.post-content') ||
                                doc.querySelector('article:not(.item)') ||
                                doc.querySelector('main article') ||
                                doc.querySelector('main');
            
            console.log('articleContent:', articleContent);
            console.log('articleContent tagName:', articleContent.tagName);
            console.log('articleContent className:', articleContent.className);
            console.log('articleContent children count:', articleContent.children.length);
            console.log('articleContent innerHTML preview:', articleContent.innerHTML.substring(0, 500));
            
            if (!articleContent) {
                alert('‚ùå Ë®ò‰∫ãÊú¨Êñá„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü\n\nÂà•„ÅÆ„Éö„Éº„Ç∏„ÇíË©¶„Åô„Åã„ÄÅÊâãÂãï„ÅßÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            let markdown = '';
            let title = '';
            articleImages = [];

            // URL„Åã„Çâ„Éá„Ç£„É¨„ÇØ„Éà„É™ÂêçÔºà„Çπ„É©„ÉÉ„Ç∞Ôºâ„ÇíÊäΩÂá∫
            try {
                const url = new URL(baseUrl);
                const pathname = url.pathname;
                // Êú´Â∞æ„ÅÆ„Çπ„É©„ÉÉ„Ç∑„É•„ÇíÂâäÈô§„Åó„Å¶„ÄÅÊúÄÂæå„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™Âêç„ÇíÂèñÂæó
                const parts = pathname.replace(/\/$/, '').split('/');
                const slug = parts[parts.length - 1];
                if (slug) {
                    slugDisplay.value = slug;
                    console.log('Extracted slug:', slug);
                }
            } catch (e) {
                console.warn('Failed to extract slug from URL:', e);
            }

            // H1„Çø„Ç§„Éà„É´„ÇíÊäΩÂá∫
            const h1 = doc.querySelector('h1') || articleContent.querySelector('h1');
            if (h1) {
                // „ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂêç„ÇíÂÖà„Å´ÊäΩÂá∫Ôºàfont size='2' or size="2"Ôºâ
                const fontTag = h1.querySelector('font[size="2"], font[size=\'2\']');
                let clientName = '';
                if (fontTag) {
                    clientName = fontTag.textContent.trim();
                    clientDisplay.value = clientName;
                }
                
                // „Çø„Ç§„Éà„É´„Åã„Çâ„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂêç„ÇíÈô§Â§ñ
                let fullText = h1.textContent.trim();
                if (clientName) {
                    // „ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂêç„Çí„Çø„Ç§„Éà„É´„Åã„ÇâÂâäÈô§
                    title = fullText.replace(clientName, '').trim();
                    // ‰ΩôÂàÜ„Å™ÊîπË°å„ÇÑÁ©∫ÁôΩ„ÇíÂâäÈô§
                    title = title.replace(/\s+/g, ' ').trim();
                } else {
                    title = fullText;
                }
                titleDisplay.value = title;
            }

            // „É°„Ç§„É≥ÁîªÂÉèÔºà„Ç¢„Ç§„Ç≠„É£„ÉÉ„ÉÅÔºâ„ÇíÊäΩÂá∫ - docÂÖ®‰Ωì„Åã„ÇâÊé¢„Åô
            const mainImageSelectors = ['#post_image', '#post_image_wrap > div', '.post_image', '[id*="post_image"]'];
            let mainImageFound = false;
            
            for (const selector of mainImageSelectors) {
                const mainImageDiv = doc.querySelector(selector);
                if (mainImageDiv && !mainImageFound) {
                    const style = mainImageDiv.getAttribute('style');
                    console.log('Checking element:', selector, 'style:', style);
                    if (style) {
                        const urlMatch = style.match(/url\(['"]?(https?:\/\/[^'")\s]+)['"]?\)/);
                        if (urlMatch) {
                            articleImages.push({
                                src: urlMatch[1],
                                alt: '„Ç¢„Ç§„Ç≠„É£„ÉÉ„ÉÅÁîªÂÉè'
                            });
                            mainImageFound = true;
                            console.log('Main image extracted:', urlMatch[1]);
                            break;
                        }
                    }
                }
            }

            // HTML„ÇΩ„Éº„Çπ„Åã„Çâ <div class="image_wrap"><div class="image" style="background:url(...)"> „ÅÆÊßãÊàê„ÇíÊäΩÂá∫
            // article#article Ë¶ÅÁ¥†ÂÜÖ„ÅÆ„Åø„ÇíÂØæË±°„Å´„Åô„Çã
            const articleElement = doc.querySelector('article#article') || doc.querySelector('article');
            
            if (articleElement) {
                // SNS„Ç∑„Çß„Ç¢„Éú„Çø„É≥Ôºàsingle_share_bottomÔºâ„ÇíÈô§Â§ñ
                const shareBottom = articleElement.querySelector('#single_share_bottom');
                if (shareBottom) {
                    shareBottom.remove();
                    console.log('Removed #single_share_bottom');
                }
                
                // ÂâçÂæåË®ò‰∫ã„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ôºànext_prev_postÔºâ„ÇíÈô§Â§ñ
                const nextPrevPost = articleElement.querySelector('#next_prev_post');
                if (nextPrevPost) {
                    nextPrevPost.remove();
                    console.log('Removed #next_prev_post navigation');
                }
                
                console.log('Searching for image_wrap in article#article');
                const articleHTML = articleElement.innerHTML;
                
                const imageWrapRegex = /<div\s+class=["']image_wrap["'][^>]*>[\s\S]*?<div\s+class=["']image["'][^>]*style=["']([^"']*)["'][^>]*>/i;
                const wrapMatch = articleHTML.match(imageWrapRegex);
                
                if (wrapMatch) {
                    const styleAttr = wrapMatch[1];
                    console.log('Found image_wrap div in article, style:', styleAttr);
                    const urlMatch = styleAttr.match(/background\s*:\s*url\s*\(\s*([^)]+)\s*\)/i);
                    if (urlMatch) {
                        const bgUrl = urlMatch[1].replace(/['"]/g, '').split(/\s+/)[0]; // ÂºïÁî®Á¨¶„Å®„Çπ„Éö„Éº„Çπ‰ª•Èôç„ÇíÈô§Âéª
                        console.log('Found image_wrap background URL:', bgUrl);
                        
                        // contactÁ≥ª„ÅÆÁîªÂÉè„Åß„Å™„Åë„Çå„Å∞ËøΩÂä†
                        if (bgUrl.startsWith('http') && !bgUrl.includes('contact-mail') && !bgUrl.includes('contact-call')) {
                            articleImages.push({
                                src: bgUrl,
                                alt: ''
                            });
                            console.log('Added article main image:', bgUrl);
                        }
                    }
                } else {
                    console.log('No image_wrap found in article#article');
                }
            } else {
                console.log('article#article element not found');
            }

            // Ë®ò‰∫ãÂÜÖ„ÅÆÂêÑË¶ÅÁ¥†„ÇíÈ†ÜÁï™„Å´Âá¶ÁêÜ
            let stopProcessing = false; // contactÁîªÂÉè‰ª•Èôç„ÅÆÂá¶ÁêÜ„Çí„Çπ„Éà„ÉÉ„Éó„Åô„Çã„Éï„É©„Ç∞
            
            function processNode(node) {
                if (stopProcessing) return; // Êó¢„Å´contactÁîªÂÉè„ÅåË¶ã„Å§„Åã„Å£„Å¶„ÅÑ„Åü„ÇâÂá¶ÁêÜÂÅúÊ≠¢
                
                const children = Array.from(node.children);
                console.log('processNode called, children count:', children.length);
                
                children.forEach((el, index) => {
                    const tagName = el.tagName;
                    console.log(`Child ${index}: ${tagName}, className: ${el.className}`);
                    
                    // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÇÑ„Çµ„Ç§„Éâ„Éê„Éº„Å™„Å©„Çí„Çπ„Ç≠„ÉÉ„Éó
                    if (el.classList.contains('nav') || 
                        el.classList.contains('sidebar') ||
                        el.classList.contains('menu') ||
                        el.classList.contains('footer') ||
                        el.id === 'sidebar') {
                        console.log('  -> „Çπ„Ç≠„ÉÉ„Éó');
                        return;
                    }
                    
                    if (tagName === 'H1') {
                        // H1„ÅØ„Çø„Ç§„Éà„É´„Å®„Åó„Å¶Êó¢„Å´Âá¶ÁêÜÊ∏à„Åø„Å™„ÅÆ„Åß„Çπ„Ç≠„ÉÉ„Éó
                        return;
                    } else if (tagName === 'H2') {
                        markdown += '## ' + el.textContent.trim() + '\n';
                    } else if (tagName === 'H3') {
                        markdown += '### ' + el.textContent.trim() + '\n';
                    } else if (tagName === 'H4') {
                        markdown += '### ' + el.textContent.trim() + '\n';
                    } else if (tagName === 'H5' || tagName === 'H6') {
                        markdown += '### ' + el.textContent.trim() + '\n';
                    } else if (tagName === 'P') {
                        const text = el.textContent.trim();
                        if (text) {
                            // ÁîªÂÉè„ÅÆ„Åø„ÇíÂê´„ÇÄpË¶ÅÁ¥†„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                            const imgOnly = el.querySelector('img') && !text.replace(/\s/g, '');
                            if (!imgOnly) {
                                markdown += text + '\n';
                            }
                        }
                        
                        // pË¶ÅÁ¥†ÂÜÖ„ÅÆiframeÔºàYouTubeÔºâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        const iframe = el.querySelector('iframe[src*="youtube.com"], iframe[src*="youtu.be"]');
                        if (iframe) {
                            markdown += iframe.outerHTML + '\n';
                        }
                        
                        // pË¶ÅÁ¥†ÂÜÖ„ÅÆÁîªÂÉè„ÇÇÂá¶ÁêÜ
                        const imgs = el.querySelectorAll('img');
                        imgs.forEach(img => {
                            processImage(img);
                        });
                    } else if (tagName === 'UL') {
                        const items = el.querySelectorAll('li');
                        items.forEach(li => {
                            markdown += '- ' + li.textContent.trim() + '\n';
                        });
                        markdown += '\n';
                    } else if (tagName === 'OL') {
                        const items = el.querySelectorAll('li');
                        items.forEach((li, i) => {
                            markdown += `${i + 1}. ${li.textContent.trim()}\n`;
                        });
                        markdown += '\n';
                    } else if (tagName === 'IMG') {
                        processImage(el);
                    } else if (tagName === 'FIGURE') {
                        // iframeÔºàYouTubeÂãïÁîª„Å™„Å©Ôºâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        const iframe = el.querySelector('iframe');
                        if (iframe) {
                            markdown += iframe.outerHTML + '\n';
                        }
                        
                        // ÁîªÂÉè„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        const img = el.querySelector('img');
                        if (img) {
                            processImage(img);
                        }
                        
                        // „Ç≠„É£„Éó„Ç∑„Éß„É≥„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        const caption = el.querySelector('figcaption');
                        if (caption) {
                            markdown += caption.textContent.trim() + 'ÔºàC\n';
                        }
                    } else if (tagName === 'HR') {
                        markdown += '---\n';
                    } else if (tagName === 'BLOCKQUOTE') {
                        const text = el.textContent.trim();
                        if (text) {
                            markdown += text + '\n';
                        }
                    } else if (tagName === 'IFRAME') {
                        // iframe„Çø„Ç∞„Çí„Åù„ÅÆ„Åæ„ÅæÊäΩÂá∫„Åó„Å¶„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„Å´ËøΩÂä†
                        markdown += el.outerHTML + '\n';
                    } else if (tagName === 'DIV' || tagName === 'SECTION' || tagName === 'ARTICLE') {
                        // DIVÂÜÖ„ÅÆiframe„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ
                        const iframe = el.querySelector('iframe');
                        if (iframe) {
                            markdown += iframe.outerHTML + '\n';
                            return; // iframeË¶ã„Å§„Åã„Å£„Åü„ÇâÂÜçÂ∏∞Âá¶ÁêÜ„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                        }
                        
                        // div.image„ÅÆbackground:url()„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        console.log('Checking DIV:', el.className, 'has image class:', el.classList.contains('image'), 'has image_wrap class:', el.classList.contains('image_wrap'));
                        
                        if (el.classList.contains('image') || el.classList.contains('image_wrap')) {
                            console.log('Found image or image_wrap div!');
                            const imageDiv = el.classList.contains('image') ? el : el.querySelector('.image');
                            console.log('imageDiv:', imageDiv);
                            if (imageDiv) {
                                const style = imageDiv.getAttribute('style');
                                console.log('style attribute:', style);
                                if (style) {
                                    const urlMatch = style.match(/url\(['"]?(https?:\/\/[^'")\s]+)['"]?\)/);
                                    console.log('urlMatch:', urlMatch);
                                    if (urlMatch) {
                                        const imgSrc = urlMatch[1];
                                        console.log('Extracted background image URL:', imgSrc);
                                        
                                        // contactÁ≥ª„ÅÆÁîªÂÉè„ÅåË¶ã„Å§„Åã„Å£„Åü„ÇâÂá¶ÁêÜ„ÇíÂÅúÊ≠¢
                                        if (imgSrc.includes('contact-mail') || imgSrc.includes('contact-call')) {
                                            console.log('Found contact image, stopping further processing:', imgSrc);
                                            stopProcessing = true;
                                            return;
                                        }
                                        
                                        articleImages.push({
                                            src: imgSrc,
                                            alt: imageDiv.getAttribute('alt') || ''
                                        });
                                        console.log('Added to articleImages, total:', articleImages.length);
                                        markdown += '„ÄêIMG„Äë\n';
                                        return; // Âá¶ÁêÜÂÆå‰∫Ü„Åó„Åü„ÇâÂÜçÂ∏∞„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                                    }
                                }
                            }
                        }
                        
                        // ÂÜçÂ∏∞ÁöÑ„Å´Â≠êË¶ÅÁ¥†„ÇíÂá¶ÁêÜ
                        processNode(el);
                    }
                });
            }

            function processImage(img) {
                console.log('processImage called for img:', img);
                if (stopProcessing) {
                    console.log('  -> stopProcessing is true, skipping');
                    return;
                }
                
                let imgSrc = img.src || img.dataset.src || img.getAttribute('data-lazy-src');
                console.log('  -> imgSrc:', imgSrc);
                if (!imgSrc) {
                    console.log('  -> No src found, skipping');
                    return;
                }
                
                // contactÁ≥ª„ÅÆÁîªÂÉè„ÅåË¶ã„Å§„Åã„Å£„Åü„ÇâÂá¶ÁêÜ„ÇíÂÅúÊ≠¢
                if (imgSrc.includes('contact-mail') || imgSrc.includes('contact-call')) {
                    console.log('  -> Found contact image, stopping further processing:', imgSrc);
                    stopProcessing = true;
                    return;
                }
                
                // Áõ∏ÂØæURL„ÇíÁµ∂ÂØæURL„Å´Â§âÊèõ
                if (!imgSrc.startsWith('http')) {
                    try {
                        const base = new URL(baseUrl);
                        imgSrc = new URL(imgSrc, base.origin).href;
                    } catch (e) {
                        console.warn('Failed to convert image URL:', imgSrc);
                    }
                }
                
                // Â∞è„Åï„ÅÑ„Ç¢„Ç§„Ç≥„É≥„ÇÑ„É≠„Ç¥„ÅØ„Çπ„Ç≠„ÉÉ„ÉóÔºàwidth/height„ÅåÂ∞è„Åï„ÅÑ„ÇÇ„ÅÆÔºâ
                const width = parseInt(img.width) || 0;
                const height = parseInt(img.height) || 0;
                console.log('  -> Image size:', width, 'x', height);
                if ((width > 0 && width < 50) || (height > 0 && height < 50)) {
                    console.log('  -> Image too small, skipping');
                    return;
                }
                
                console.log('  -> Adding image to articleImages');
                articleImages.push({
                    src: imgSrc,
                    alt: img.alt || 'ÁîªÂÉè'
                });
                
                markdown += '‚òÖÁîªÂÉè\n';
            }

            // Ë®ò‰∫ãÊú¨Êñá„ÇíÂá¶ÁêÜÈñãÂßã
            processNode(articleContent);
            
            // ‰ΩôÂàÜ„Å™ÊîπË°å„ÇíÂâäÈô§Ôºà3Ë°å‰ª•‰∏ä„ÅÆÈÄ£Á∂öÊîπË°å„Çí2Ë°å„Å´„Åô„ÇãÔºâ
            markdown = markdown.replace(/\n{3,}/g, '\n\n').trim();
            
            console.log('Âá¶ÁêÜÂæå„ÅÆmarkdown preview:', markdown.substring(0, 200));

            markdownEditor.value = markdown.trim();
            console.log('„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Ë®≠ÂÆöÂÆå‰∫Ü, length:', markdown.length);
            console.log('ÁîªÂÉèÊï∞:', articleImages.length);
            
            updateHTML();
            displayImages();
            
            console.log('parseArticle ÂÆå‰∫Ü');
        }

        function displayImages() {
            console.log('displayImages called, articleImages.length:', articleImages.length);
            
            if (articleImages.length === 0) {
                imagesGrid.innerHTML = '<div class="empty-state">ÁîªÂÉè„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</div>';
                return;
            }

            imagesGrid.innerHTML = '';
            articleImages.forEach((img, index) => {
                console.log(`Image ${index}: src="${img.src}", alt="${img.alt}"`);
                const item = document.createElement('div');
                item.style.cssText = 'display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 8px;';
                
                // ÁîªÂÉèÁï™Âè∑
                const label = document.createElement('div');
                label.textContent = `ÁîªÂÉè${index + 1}:`;
                label.style.cssText = 'font-weight: bold; color: #2c3e50; min-width: 60px;';
                item.appendChild(label);
                
                // Êñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„Åè„Éú„Çø„É≥Ôºà„Ç∞„É™„Éº„É≥Ôºâ
                const openBtn = document.createElement('button');
                openBtn.textContent = 'Êñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„Åè';
                openBtn.style.cssText = 'flex: 1; padding: 8px 12px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px;';
                openBtn.addEventListener('click', function() {
                    window.open(img.src, '_blank');
                });
                item.appendChild(openBtn);
                
                imagesGrid.appendChild(item);
            });
        }

        function handleDragStart(event, index) {
            event.dataTransfer.setData('text/uri-list', articleImages[index].src);
            event.dataTransfer.setData('text/plain', articleImages[index].src);
        }

        function copyImageUrl(index, button) {
            const url = articleImages[index].src;
            navigator.clipboard.writeText(url).then(() => {
                const originalText = button.textContent;
                button.textContent = '„Ç≥„Éî„ÉºÂÆå‰∫ÜÔºÅ';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        function updateHTML() {
            const markdown = markdownEditor.value;
            const result = convertToHTML(markdown);
            htmlOutput.textContent = result.html.trim();
            if (result.title) {
                titleDisplay.value = result.title;
            }
        }

        function convertToHTML(text) {
            if (!text.trim()) return { html: '', title: '' };

            let title = '';

            // YouTubeÂüã„ÇÅËæº„Åø
            text = text.replace(/https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)(?:[^\s]*)?/g, (match, videoId) => {
                return `<div class="yt">\n<iframe title="YouTube video player" src="https://www.youtube.com/embed/${videoId}" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe>\n</div>`;
            });
            
            text = text.replace(/https?:\/\/(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]+)(?:[^\s]*)?/g, (match, videoId) => {
                return `<div class="yt">\n<iframe title="YouTube video player" src="https://www.youtube.com/embed/${videoId}" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe>\n</div>`;
            });

            let lines = text.split('\n');
            let html = '';
            let inList = false;
            let listType = '';
            let paragraphBuffer = [];

            function flushParagraph() {
                if (paragraphBuffer.length > 0) {
                    let content = paragraphBuffer.join('<br>');
                    html += '<p>' + processInlineFormatting(content) + '</p>\n';
                    paragraphBuffer = [];
                }
            }

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];

                if (line.trim() === '') {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '\n';
                    continue;
                }

                if (line.trim() === '---') {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '<hr>\n';
                    continue;
                }

                if (line.startsWith('# ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    const h1Text = line.substring(2);
                    title = h1Text;
                    continue;
                }
                if (line.startsWith('###### ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    html += '<h6>' + line.substring(7) + '</h6>\n';
                    continue;
                }
                if (line.startsWith('##### ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    html += '<h5>' + line.substring(6) + '</h5>\n';
                    continue;
                }
                if (line.startsWith('#### ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    html += '<h4>' + line.substring(5) + '</h4>\n';
                    continue;
                }
                if (line.startsWith('### ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    html += '<h3>' + line.substring(4) + '</h3>\n';
                    continue;
                }
                if (line.startsWith('## ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    html += '<h2>' + line.substring(3) + '</h2>\n';
                    continue;
                }

                if (line.match(/^[-*]\s/)) {
                    flushParagraph();
                    if (!inList || listType !== 'ul') {
                        if (inList && listType === 'ol') html += '</ol>\n';
                        html += '<ul>\n';
                        inList = true;
                        listType = 'ul';
                    }
                    html += '  <li>' + processInlineFormatting(line.substring(2)) + '</li>\n';
                    continue;
                }

                if (line.match(/^\d+\.\s/)) {
                    flushParagraph();
                    if (!inList || listType !== 'ol') {
                        if (inList && listType === 'ul') html += '</ul>\n';
                        html += '<ol>\n';
                        inList = true;
                        listType = 'ol';
                    }
                    html += '  <li>' + processInlineFormatting(line.replace(/^\d+\.\s/, '')) + '</li>\n';
                    continue;
                }

                if (line.startsWith('‚òÖÁîªÂÉè')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '‚òÖÁîªÂÉè\n';
                    continue;
                }

                if (line.includes('<iframe')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    // iframe„ÅåË§áÊï∞Ë°å„Å´„Åæ„Åü„Åå„ÇãÂ†¥Âêà„ÇÇÂØæÂøú
                    let iframeCode = line;
                    while (!iframeCode.includes('</iframe>') && i + 1 < lines.length) {
                        i++;
                        iframeCode += lines[i];
                    }
                    html += iframeCode + '\n';
                    continue;
                }

                const urlOnlyMatch = line.trim().match(/^(https?:\/\/[^\s]+)$/);
                if (urlOnlyMatch) {
                    const url = urlOnlyMatch[1];
                    
                    // YouTube URL„ÅØ„Åù„ÅÆ„Åæ„ÅæÂá¶ÁêÜ
                    if (url.includes('youtube.com') || url.includes('youtu.be')) {
                        flushParagraph();
                        if (inList) {
                            html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                            inList = false;
                        }
                        html += '<p><a href="' + url + '" target="_blank">' + url + '</a></p>\n';
                        continue;
                    }
                    
                    // Áõ¥Ââç„Å´ÊÆµËêΩ„Éê„ÉÉ„Éï„Ç°„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅ„Åù„Çå„Çí„É™„É≥„ÇØ„ÉÜ„Ç≠„Çπ„Éà„Å´„Åô„Çã
                    if (paragraphBuffer.length > 0) {
                        const linkText = paragraphBuffer.join('<br>');
                        paragraphBuffer = [];
                        if (inList) {
                            html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                            inList = false;
                        }
                        html += '<p><a href="' + url + '" target="_blank">' + processInlineFormatting(linkText) + '</a></p>\n';
                        continue;
                    }
                    
                    // Áõ¥Ââç„Å´ÊÆµËêΩ„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅURL„Çí„Åù„ÅÆ„Åæ„ÅæË°®Á§∫
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '<p><a href="' + url + '" target="_blank">' + url + '</a></p>\n';
                    continue;
                }

                // ALTÔºâ„ÅßÂßã„Åæ„ÇãË°å„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàP„Çø„Ç∞„ÅßÂõ≤„Åæ„Å™„ÅÑÔºâ
                if (line.trim().startsWith('ALTÔºâ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    // ALTÔºâ„Çí„Åù„ÅÆ„Åæ„ÅæÂá∫ÂäõÔºàP„Çø„Ç∞„Å™„ÅóÔºâ
                    html += processInlineFormatting(line.trim()) + '\n';
                    continue;
                }

                // ÔºàC „Åæ„Åü„ÅØÔºàALT „ÅßÁµÇ„Çè„ÇãË°å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (line.trim().endsWith('ÔºàC') || line.trim().endsWith('ÔºàALT')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    // ÔºàC „Åæ„Åü„ÅØÔºàALT „ÇíÂâäÈô§„Åó„Å¶P„Çø„Ç∞„ÅßÂõ≤„ÇÄ
                    let content = line.trim().replace(/ÔºàC$/, '').replace(/ÔºàALT$/, '');
                    // Á©∫ÁôΩ„ÅÆ„Åø„ÅÆÂ†¥Âêà„ÅØ‚òÖ„ÇíÂÖ•„Çå„Çã
                    if (content.trim() === '') {
                        content = '‚òÖ';
                    }
                    html += '<p>' + processInlineFormatting(content) + '</p>\n';
                    continue;
                }

                if (inList) {
                    html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                    inList = false;
                }
                paragraphBuffer.push(line);
            }

            flushParagraph();

            if (inList) {
                html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
            }

            return { html: html, title: title };
        }

        function processInlineFormatting(text) {
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/(https?:\/\/(?!(?:www\.)?(?:youtube\.com|youtu\.be))[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
            return text;
        }

        function copyHTML() {
            const html = htmlOutput.textContent;
            if (!html.trim()) {
                alert('HTML„Ç≥„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = html;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                const button = event.target;
                button.textContent = '‚úì „Ç≥„Éî„ÉºÂÆå‰∫ÜÔºÅ';
                button.style.background = '#95a5a6';
            } catch (err) {
                console.error('„Ç≥„Éî„ÉºÂ§±Êïó:', err);
                alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            } finally {
                document.body.removeChild(textarea);
            }
        }

        function copyTitle() {
            const title = titleDisplay.value;
            if (!title.trim()) {
                alert('„Çø„Ç§„Éà„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = title;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                const button = event.target;
                button.textContent = '‚úì „Ç≥„Éî„ÉºÂÆå‰∫ÜÔºÅ';
                button.style.background = '#95a5a6';
            } catch (err) {
                console.error('„Ç≥„Éî„ÉºÂ§±Êïó:', err);
                alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            } finally {
                document.body.removeChild(textarea);
            }
        }

        function copyClient() {
            const client = clientDisplay.value;
            if (!client.trim()) {
                alert('„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂêç„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = client;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                const button = event.target;
                button.textContent = '‚úì „Ç≥„Éî„ÉºÂÆå‰∫ÜÔºÅ';
                button.style.background = '#95a5a6';
            } catch (err) {
                console.error('„Ç≥„Éî„ÉºÂ§±Êïó:', err);
                alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            } finally {
                document.body.removeChild(textarea);
            }
        }

        function copySlug() {
            const slug = slugDisplay.value;
            if (!slug.trim()) {
                alert('„Éá„Ç£„É¨„ÇØ„Éà„É™Âêç„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = slug;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                const button = event.target;
                button.textContent = '‚úì „Ç≥„Éî„ÉºÂÆå‰∫ÜÔºÅ';
                button.style.background = '#95a5a6';
            } catch (err) {
                console.error('„Ç≥„Éî„ÉºÂ§±Êïó:', err);
                alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            } finally {
                document.body.removeChild(textarea);
            }
        }

        function applyFormat(format) {
            const start = markdownEditor.selectionStart;
            const end = markdownEditor.selectionEnd;
            
            if (format === 'image') {
                const beforeText = markdownEditor.value.substring(0, start);
                const afterText = markdownEditor.value.substring(end);
                markdownEditor.value = beforeText + '‚òÖÁîªÂÉè\n' + afterText;
                const newPosition = start + 4;
                markdownEditor.setSelectionRange(newPosition, newPosition);
                markdownEditor.focus();
                updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
                return;
            }
            
            let selectedText = markdownEditor.value.substring(start, end);
            let realStart = start;
            let realEnd = end;
            
            if (start === end) {
                const text = markdownEditor.value;
                let lineStart = start;
                let lineEnd = end;
                
                while (lineStart > 0 && text[lineStart - 1] !== '\n') {
                    lineStart--;
                }
                
                while (lineEnd < text.length && text[lineEnd] !== '\n') {
                    lineEnd++;
                }
                
                selectedText = text.substring(lineStart, lineEnd);
                realStart = lineStart;
                realEnd = lineEnd;
            }
            
            if (!selectedText.trim() && format !== 'paragraph' && format !== 'alt') {
                alert('„ÉÜ„Ç≠„Çπ„Éà„ÇíÈÅ∏Êäû„Åô„Çã„Åã„ÄÅ„Ç´„Éº„ÇΩ„É´„ÇíË°å„Å´ÈÖçÁΩÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            let newText = '';
            const beforeText = markdownEditor.value.substring(0, realStart);
            const afterText = markdownEditor.value.substring(realEnd);

            switch(format) {
                case 'h1':
                    newText = '# ' + selectedText.replace(/^#{1,6}\s*/, '');
                    break;
                case 'h2':
                    newText = '## ' + selectedText.replace(/^#{1,6}\s*/, '');
                    break;
                case 'h3':
                    newText = '### ' + selectedText.replace(/^#{1,6}\s*/, '');
                    break;
                case 'h4':
                    newText = '#### ' + selectedText.replace(/^#{1,6}\s*/, '');
                    break;
                case 'h5':
                    newText = '##### ' + selectedText.replace(/^#{1,6}\s*/, '');
                    break;
                case 'h6':
                    newText = '###### ' + selectedText.replace(/^#{1,6}\s*/, '');
                    break;
                case 'bold':
                    newText = '**' + selectedText + '**';
                    break;
                case 'ul':
                    // Êó¢Â≠ò„ÅÆ„É™„Çπ„Éà„Éó„É¨„Éï„Ç£„ÉÉ„ÇØ„Çπ„ÇíÂâäÈô§„Åó„Å¶„Åã„ÇâÁÆáÊù°Êõ∏„Åç„Å´
                    newText = selectedText.split('\n').map(line => {
                        const trimmed = line.trim();
                        if (!trimmed) return line;
                        // Êó¢Â≠ò„ÅÆÁï™Âè∑‰ªò„Åç„É™„Çπ„Éà„ÇÑÁÆáÊù°Êõ∏„Åç„ÇíÂâäÈô§
                        const cleaned = trimmed.replace(/^[-*]\s+/, '').replace(/^\d+\.\s+/, '');
                        return '- ' + cleaned;
                    }).join('\n');
                    break;
                case 'ol':
                    // Êó¢Â≠ò„ÅÆ„É™„Çπ„Éà„Éó„É¨„Éï„Ç£„ÉÉ„ÇØ„Çπ„ÇíÂâäÈô§„Åó„Å¶„Åã„ÇâÁï™Âè∑‰ªò„Åç„É™„Çπ„Éà„Å´
                    newText = selectedText.split('\n').map((line, i) => {
                        const trimmed = line.trim();
                        if (!trimmed) return line;
                        // Êó¢Â≠ò„ÅÆÁï™Âè∑‰ªò„Åç„É™„Çπ„Éà„ÇÑÁÆáÊù°Êõ∏„Åç„ÇíÂâäÈô§
                        const cleaned = trimmed.replace(/^[-*]\s+/, '').replace(/^\d+\.\s+/, '');
                        return `${i + 1}. ${cleaned}`;
                    }).join('\n');
                    break;
                case 'caption':
                    newText = selectedText + 'ÔºàC';
                    break;
                case 'alt':
                    // „ÉÜ„Ç≠„Çπ„ÉàÈÅ∏ÊäûÊôÇ: ALTÔºâ„ÉÜ„Ç≠„Çπ„Éà
                    // ‰Ωï„ÇÇ„Å™„ÅÑÊôÇ: ALTÔºâ‚òÖ
                    if (selectedText.trim()) {
                        newText = 'ALTÔºâ' + selectedText;
                    } else {
                        newText = 'ALTÔºâ‚òÖ';
                    }
                    break;
                case 'paragraph':
                    // ÈÅ∏Êäû„Åï„Çå„ÅüË°å„ÇíÁ©∫Ë°å„ÅßÂõ≤„ÇÄÔºàÊÆµËêΩ„Å®„Åó„Å¶Êâ±„ÅÜÔºâ
                    newText = selectedText;
                    // Ââç„Å´Á©∫Ë°å„ÇíËøΩÂä†ÔºàÊó¢„Å´Á©∫Ë°å„Åå„Å™„ÅÑÂ†¥ÂêàÔºâ
                    const addBefore = beforeText.endsWith('\n\n') || beforeText === '' ? '' : '\n';
                    // Âæå„Çç„Å´Á©∫Ë°å„ÇíËøΩÂä†ÔºàÊó¢„Å´Á©∫Ë°å„Åå„Å™„ÅÑÂ†¥ÂêàÔºâ
                    const addAfter = afterText.startsWith('\n\n') || afterText === '' ? '' : '\n';
                    markdownEditor.value = beforeText + addBefore + newText + addAfter + afterText;
                    markdownEditor.focus();
                    updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
                    return;
            }

            markdownEditor.value = beforeText + newText + afterText;
            const newPosition = realStart + newText.length;
            markdownEditor.setSelectionRange(newPosition, newPosition);
            markdownEditor.focus();
            updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
        }

        function clearFormat() {
            const start = markdownEditor.selectionStart;
            const end = markdownEditor.selectionEnd;
            
            let selectedText = markdownEditor.value.substring(start, end);
            let realStart = start;
            let realEnd = end;
            
            // „Ç´„Éº„ÇΩ„É´„ÅÆ„Åø„ÅÆÂ†¥Âêà„ÅØË°åÂÖ®‰Ωì„ÇíÂØæË±°„Å´„Åô„Çã
            if (start === end) {
                const text = markdownEditor.value;
                let lineStart = start;
                let lineEnd = end;
                
                while (lineStart > 0 && text[lineStart - 1] !== '\n') {
                    lineStart--;
                }
                
                while (lineEnd < text.length && text[lineEnd] !== '\n') {
                    lineEnd++;
                }
                
                selectedText = text.substring(lineStart, lineEnd);
                realStart = lineStart;
                realEnd = lineEnd;
            }
            
            if (!selectedText.trim()) {
                return;
            }
            
            const beforeText = markdownEditor.value.substring(0, realStart);
            const afterText = markdownEditor.value.substring(realEnd);
            
            // ÂêÑÁ®Æ„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Ë®òÊ≥ï„ÇíÂâäÈô§
            let cleanText = selectedText
                .replace(/^#{1,6}\s+/gm, '')           // Ë¶ãÂá∫„Åó (#, ##, ###)
                .replace(/^\s*[-*]\s+/gm, '')          // ÁÆáÊù°Êõ∏„Åç (-, *)
                .replace(/^\s*\d+\.\s+/gm, '')         // Áï™Âè∑‰ªò„Åç„É™„Çπ„Éà (1., 2., ...)
                .replace(/\*\*(.+?)\*\*/g, '$1')       // Â§™Â≠ó (**text**)
                .replace(/ÔºàC$/gm, '')                 // „Ç≠„É£„Éó„Ç∑„Éß„É≥
                .replace(/ÔºàALT$/gm, '');              // ALT
            
            markdownEditor.value = beforeText + cleanText + afterText;
            markdownEditor.setSelectionRange(realStart, realStart + cleanText.length);
            markdownEditor.focus();
            updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
        }

        function insertHR() {
            const start = markdownEditor.selectionStart;
            const end = markdownEditor.selectionEnd;
            const beforeText = markdownEditor.value.substring(0, start);
            const afterText = markdownEditor.value.substring(end);
            
            markdownEditor.value = beforeText + '---' + afterText;
            const newPosition = start + 3;
            markdownEditor.setSelectionRange(newPosition, newPosition);
            markdownEditor.focus();
            updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
        }

        function deleteLine() {
            const start = markdownEditor.selectionStart;
            const end = markdownEditor.selectionEnd;
            
            // „ÉÜ„Ç≠„Çπ„Éà„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈÅ∏ÊäûÈÉ®ÂàÜ„ÅÆ„ÅøÂâäÈô§
            if (start !== end) {
                const beforeText = markdownEditor.value.substring(0, start);
                const afterText = markdownEditor.value.substring(end);
                markdownEditor.value = beforeText + afterText;
                markdownEditor.setSelectionRange(start, start);
                markdownEditor.focus();
                updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
                return;
            }
            
            // ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Ç´„Éº„ÇΩ„É´„Åå„ÅÇ„ÇãË°åÂÖ®‰Ωì„ÇíÂâäÈô§
            const text = markdownEditor.value;
            let lineStart = start;
            let lineEnd = end;
            
            // Ë°å„ÅÆÈñãÂßã‰ΩçÁΩÆ„ÇíÊé¢„Åô
            while (lineStart > 0 && text[lineStart - 1] !== '\n') {
                lineStart--;
            }
            
            // Ë°å„ÅÆÁµÇ‰∫Ü‰ΩçÁΩÆ„ÇíÊé¢„ÅôÔºàÊîπË°åÊñáÂ≠ó„ÇíÂê´„ÇÄÔºâ
            while (lineEnd < text.length && text[lineEnd] !== '\n') {
                lineEnd++;
            }
            if (lineEnd < text.length) lineEnd++; // ÊîπË°åÊñáÂ≠ó„ÇÇÂâäÈô§
            
            const beforeText = text.substring(0, lineStart);
            const afterText = text.substring(lineEnd);
            
            markdownEditor.value = beforeText + afterText;
            markdownEditor.setSelectionRange(lineStart, lineStart);
            markdownEditor.focus();
            updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
        }

        function insertLineBreak() {
            const start = markdownEditor.selectionStart;
            const end = markdownEditor.selectionEnd;
            const beforeText = markdownEditor.value.substring(0, start);
            const afterText = markdownEditor.value.substring(end);
            
            markdownEditor.value = beforeText + '\n' + afterText;
            const newPosition = start + 1;
            markdownEditor.setSelectionRange(newPosition, newPosition);
            markdownEditor.focus();
            updateHTML(); // ÊâãÂãïÊõ¥Êñ∞
        }

        function resetAll() {
            // „Åô„Åπ„Å¶„ÇØ„É™„Ç¢
            markdownEditor.value = '';
            htmlSource.value = '';
            urlInput.value = '';
            titleDisplay.value = '';
            clientDisplay.value = '';
            slugDisplay.value = '';
            htmlOutput.innerHTML = '<div class="empty-state">URL„ÇíÂÖ•Âäõ„Åó„Å¶„ÄåË®ò‰∫ã„ÇíË™≠„ÅøËæº„ÇÄ„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
            imagesGrid.innerHTML = '<div class="empty-state">ÁîªÂÉè„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
            articleImages = [];
            
            // „Åô„Åπ„Å¶„ÅÆ„Ç≥„Éî„Éº„Éú„Çø„É≥„ÇíÂàùÊúüÁä∂ÊÖã„Å´Êàª„Åô
            const allButtons = document.querySelectorAll('button');
            allButtons.forEach(button => {
                if (button.textContent.includes('‚úì „Ç≥„Éî„ÉºÂÆå‰∫Ü')) {
                    // „Ç≥„Éî„Éº„Éú„Çø„É≥„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„Å¶ÂÖÉ„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å´Êàª„Åô
                    if (button.onclick && button.onclick.toString().includes('copyTitle')) {
                        button.textContent = '„Ç≥„Éî„Éº';
                    } else if (button.onclick && button.onclick.toString().includes('copyClient')) {
                        button.textContent = '„Ç≥„Éî„Éº';
                    } else if (button.onclick && button.onclick.toString().includes('copySlug')) {
                        button.textContent = '„Ç≥„Éî„Éº';
                    } else if (button.id === 'copyHTMLBtn') {
                        button.textContent = 'HTML„Çí„Ç≥„Éî„Éº';
                    }
                    button.style.background = button.id === 'copyHTMLBtn' ? '#27ae60' : '#3498db';
                }
            });
            
            markdownEditor.focus();
        }

        // „Åô„Åπ„Å¶„ÅÆÁîªÂÉè„ÇíÊñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„ÅèÔºàÈ†ÜÊ¨°ÂÆüË°åÔºâ
        function openAllImages() {
            console.log('openAllImages called, articleImages.length:', articleImages.length);
            
            if (articleImages.length === 0) {
                alert('ÁîªÂÉè„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // 200msÈñìÈöî„ÅßÈ†ÜÊ¨°Èñã„ÅèÔºà„Éñ„É≠„ÉÉ„ÇØÂõûÈÅøÔºâ
            articleImages.forEach((img, index) => {
                setTimeout(() => {
                    console.log(`Opening image ${index + 1}:`, img.src);
                    window.open(img.src, '_blank');
                }, index * 200);
            });
        }
    </script>
</body>
</html>
